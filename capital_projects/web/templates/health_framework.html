{% extends "base.html" %}

{% block content %}
<!-- Framework Description -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Project Health Framework</h3>
    <p class="text-gray-600 mb-4">
        The Project Health Framework categorizes capital projects based on two key dimensions:
        <strong>Strategic Value</strong> (benefit to the community) and <strong>Deliverability</strong> (readiness to execute).
    </p>
    <div class="grid grid-cols-5 gap-4 text-center">
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <p class="font-semibold text-green-700">ADVANCE</p>
            <p class="text-sm text-green-600">High value, ready to execute</p>
        </div>
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
            <p class="font-semibold text-amber-700">MONITOR</p>
            <p class="text-sm text-amber-600">Proceed with oversight</p>
        </div>
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
            <p class="font-semibold text-orange-700">RE-SCOPE</p>
            <p class="text-sm text-orange-600">Address issues first</p>
        </div>
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
            <p class="font-semibold text-gray-700">DEFER</p>
            <p class="text-sm text-gray-600">Push to future</p>
        </div>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="font-semibold text-red-700">CANCEL</p>
            <p class="text-sm text-red-600">Terminate project</p>
        </div>
    </div>
</div>

<!-- Category Counts -->
<div class="grid grid-cols-5 gap-4 mb-6">
    <div class="bg-green-100 rounded-lg p-6 text-center">
        <p class="text-4xl font-bold text-green-700">{{ summary.advance_count or 0 }}</p>
        <p class="text-green-600 font-medium">Advance</p>
    </div>
    <div class="bg-amber-100 rounded-lg p-6 text-center">
        <p class="text-4xl font-bold text-amber-700">{{ summary.monitor_count or 0 }}</p>
        <p class="text-amber-600 font-medium">Monitor</p>
    </div>
    <div class="bg-orange-100 rounded-lg p-6 text-center">
        <p class="text-4xl font-bold text-orange-700">{{ summary.rescope_count or 0 }}</p>
        <p class="text-orange-600 font-medium">Re-scope</p>
    </div>
    <div class="bg-gray-100 rounded-lg p-6 text-center">
        <p class="text-4xl font-bold text-gray-700">{{ summary.defer_count or 0 }}</p>
        <p class="text-gray-600 font-medium">Defer</p>
    </div>
    <div class="bg-red-100 rounded-lg p-6 text-center">
        <p class="text-4xl font-bold text-red-700">{{ summary.cancel_count or 0 }}</p>
        <p class="text-red-600 font-medium">Cancel</p>
    </div>
</div>

<!-- Quadrant Chart -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Strategic Value vs Deliverability Quadrant</h3>
    <div id="quadrant-chart" style="height: 500px;"></div>
</div>

<!-- Projects by Category -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Advance Projects -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-green-700 mb-4 flex items-center">
            <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
            Advance Projects
        </h3>
        <div class="space-y-2">
            {% for project in projects if project.Status == 'Advance' %}
            <a href="{{ url_for('project_detail', project_id=project['Project ID']) }}"
               class="block p-3 bg-green-50 rounded hover:bg-green-100 transition">
                <p class="font-medium text-gray-900">{{ project['Project Name'] }}</p>
                <p class="text-sm text-gray-500">{{ project['Current Phase'] }} | ${{ '{:,.0f}'.format(project['Total Budget']) }}</p>
            </a>
            {% else %}
            <p class="text-gray-500 italic">No projects in this category</p>
            {% endfor %}
        </div>
    </div>

    <!-- Re-scope Projects -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-orange-700 mb-4 flex items-center">
            <span class="w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
            Re-scope Projects
        </h3>
        <div class="space-y-2">
            {% for project in projects if project.Status == 'Re-scope' %}
            <a href="{{ url_for('project_detail', project_id=project['Project ID']) }}"
               class="block p-3 bg-orange-50 rounded hover:bg-orange-100 transition">
                <p class="font-medium text-gray-900">{{ project['Project Name'] }}</p>
                <p class="text-sm text-gray-500">{{ project['Current Phase'] }} | ${{ '{:,.0f}'.format(project['Total Budget']) }}</p>
            </a>
            {% else %}
            <p class="text-gray-500 italic">No projects in this category</p>
            {% endfor %}
        </div>
    </div>

    <!-- Monitor Projects -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-amber-700 mb-4 flex items-center">
            <span class="w-3 h-3 bg-amber-500 rounded-full mr-2"></span>
            Monitor Projects
        </h3>
        <div class="space-y-2">
            {% for project in projects if project.Status == 'Monitor' %}
            <a href="{{ url_for('project_detail', project_id=project['Project ID']) }}"
               class="block p-3 bg-amber-50 rounded hover:bg-amber-100 transition">
                <p class="font-medium text-gray-900">{{ project['Project Name'] }}</p>
                <p class="text-sm text-gray-500">{{ project['Current Phase'] }} | ${{ '{:,.0f}'.format(project['Total Budget']) }}</p>
            </a>
            {% else %}
            <p class="text-gray-500 italic">No projects in this category</p>
            {% endfor %}
        </div>
    </div>

    <!-- Defer/Cancel Projects -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
            <span class="w-3 h-3 bg-gray-500 rounded-full mr-2"></span>
            Defer / Cancel Projects
        </h3>
        <div class="space-y-2">
            {% for project in projects if project.Status in ['Defer', 'Cancel'] %}
            <a href="{{ url_for('project_detail', project_id=project['Project ID']) }}"
               class="block p-3 {% if project.Status == 'Cancel' %}bg-red-50 hover:bg-red-100{% else %}bg-gray-50 hover:bg-gray-100{% endif %} rounded transition">
                <p class="font-medium text-gray-900">{{ project['Project Name'] }}</p>
                <p class="text-sm text-gray-500">{{ project.Status }} | {{ project['Current Phase'] }}</p>
            </a>
            {% else %}
            <p class="text-gray-500 italic">No projects in this category</p>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    {% if charts.quadrant %}
    Plotly.newPlot('quadrant-chart', {{ charts.quadrant | safe }}.data, {{ charts.quadrant | safe }}.layout, {responsive: true});
    {% endif %}
</script>
{% endblock %}
